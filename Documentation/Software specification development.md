# 6. Разработка спецификации ПО

**TourBooking** — Android-приложение для бронирования туристических туров. Использует облачную БД **Firebase Firestore** и архитектуру **MVVM**.

## а) Модуль аутентификации

**Компоненты:** AuthActivity, FirebaseAuth  
**Функции:** Регистрация и авторизация по email/пароль. Разделение ролей: пользователь (user) и администратор (admin).  
**Данные:** Коллекция users хранит email, имя, роль и дату создания. Вложенная коллекция favorites для избранного.  
**Ограничения:** Все функции требуют авторизации. Роль определяется при первом входе.

## б) Модуль управления турами

**Компоненты:** Tour, HomeFragment, TourDetailActivity, AdminToursFragment  
**Функции:** Просмотр каталога, детальная информация, добавление в избранное, сортировка, количество мест и маршрут. Администратор: создание, редактирование, удаление туров.  
**Сущность Tour:** id, title, description, country, price, imageUrl, active.  
**Ограничения:** Обычные пользователи видят только активные туры (active=true). Изображения загружаются через **Glide**.

## в) Модуль бронирования

**Компоненты:** Booking, BookingsFragment, AdminBookingsFragment  
**Функции:** Оформление брони с указанием участников, просмотр истории, выбором дат. Администратор может только отменить бронировние.  
**Сущность Booking:** id, userId, tourId, participants, status, totalPrice, createdAt.  
**Статусы:** pending (ожидание), confirmed (подтверждено), cancelled (отменено).  
**Ограничения:** Пользователи видят только свои брони. Отмена — только через администратора.

## г) Модуль управления датами

**Компоненты:** DatePickerDialog, Calendar, SimpleDateFormat, кастомная логика в AddEditTourActivity и TourDetailActivity

**Функции:**
- **Для администраторов:** Установка фиксированного диапазона дат для каждого тура через `DatePickerDialog`
- **Для пользователей:** Выбор конкретных дат поездки в пределах установленного администратором диапазона
- Автоматический расчет продолжительности поездки
- Валидация выбранных дат (нельзя выбрать даты за пределами диапазона тура)

**Реализация:**
1. Администратор устанавливает даты через AddEditTourActivity:
   - Два отдельных DatePickerDialog для начала и окончания
   - Автоматический расчет продолжительности
2. Пользователь выбирает даты через TourDetailActivity:
   - Ограничение выбора датами тура через setMinDate() и setMaxDate()
   - Проверка что дата окончания позже даты начала

**Ограничения:** Пользователь не может выбрать даты за пределами диапазона, установленного администратором.

## д) Модуль базы данных (Firebase)

**Компоненты:** FirebaseFirestore, FirebaseAuth, облачные правила безопасности  
**Структура БД:**
- Коллекция tours – все туристические предложения
- Коллекция bookings – все бронирования пользователей  
- Коллекция users – профили пользователей
- Вложенные коллекции users/{id}/favorites – избранные туры

**Функции:** Синхронизация в реальном времени, офлайн-поддержка, автоматическое масштабирование.  
**Ограничения:** Правила безопасности Firestore контролируют доступ к данным. Требуется интернет-соединение для полной функциональности.

## е) Модуль навигации и UI

**Компоненты:** MainActivity, BottomNavigationView, адаптеры (TourAdapter, BookingAdapter)  
**Функции:** Навигация через нижнее меню (6 пунктов). Динамическое меню: админские пункты скрыты для user. Списки через RecyclerView.  
**Экраны:** Туры, Брони, Избранное, Профиль, Управление (admin), Подтверждение (admin).  
**Ограничения:** Все экраны требуют авторизации. Данные обновляются в реальном времени из Firebase.
